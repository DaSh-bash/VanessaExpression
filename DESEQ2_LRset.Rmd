---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
plot(cars)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.


```{r}
library( "DESeq2" )
library(ggplot2)
```


```{r}
library(plyr)
```



```{r}
names(colDataLR)[names(colDataLR)=="Group3"]<-"tissue"
names(colDataLR)[names(colDataLR)=="Group1"]<-"condition"
```

https://www.geeksforgeeks.org/r-dataframe-manipulation/



```{r}
load("/Users/dshipilina/GitHub/VanessaExpression/deseq2_qc/deseq2.dds.RData")
#dds
head(colData(dds))
```

```{r}
dds@colData
keep <- rowSums(counts(dds)) >= 10
dds <- dds[keep,]
```

Need to assign groups!!!!

```{r}
design(dds)<- ~ 2
design(dds)
```
```{r}
res <- results(dds)
head(results(dds, tidy=TRUE))
#reset par
par(mfrow=c(1,1))
# Make a basic volcano plot
with(res, plot(log2FoldChange, -log10(pvalue), pch=20, main="Volcano plot", xlim=c(-3,3)))
 
# Add colored points: blue if padj<0.01, red if log2FC>1 and padj<0.05)
with(subset(res, padj<.01 ), points(log2FoldChange, -log10(pvalue), pch=20, col="blue"))
with(subset(res, padj<.01 & abs(log2FoldChange)>2), points(log2FoldChange, -log10(pvalue), pch=20, col="red"))
```

```{r}
```


```{r}
vsdata <- vst(dds, blind=FALSE)
plotPCA(vsdata, intgroup="Group1")
```


```{r}
```


```

Diary for Sept 20th

**Creating dataset based on original counts from nf-core pipeline**
```{r}
countLR<- dds@assays@data@listData[["counts"]]
colDataLR <- colData(dds)
ddsLR <- DESeqDataSetFromMatrix(countData=countLR, colData =colDataLR, design = ~Group3)
```
```{r}
keep <- rowSums(counts(ddsLR)) >= 10
ddsLR <- ddsLR[keep,]
head(ddsLR)
```


```{r}
ddsLR <- DESeq(ddsLR)
resLR <- results(ddsLR)
resLR <- resLR[order(resLR$padj),]
head(resLR)
```


```{r}
plotMA(resLR, ylim=c(-20,20))
```

```{r}
#reset par
par(mfrow=c(1,1))
# Make a basic volcano plot
with(resLR, plot(log2FoldChange, -log10(pvalue), pch=20, main="Volcano plot", xlim=c(-3,3)))

# Add colored points: blue if padj<0.01, red if log2FC>1 and padj<0.05)
with(subset(resLR, padj<.01 ), points(log2FoldChange, -log10(pvalue), pch=20, col="blue"))
with(subset(resLR, padj<.01 & abs(log2FoldChange)>2), points(log2FoldChange, -log10(pvalue), pch=20, col="red"))
```


```{r}
vsdata <- vst(dddsLR, blind=FALSE)
plotPCA(vsdata, intgroup="Group3")
```




**Checking genes separately**
```{bash}
grep "Vcard_DToL11948" makerrun3.all.maker.eggnog.filtered.genes.gff 
```
7 transmembrane receptor (rhodopsin family)

```{bash}
grep "Vcard_DToL02239" makerrun3.all.maker.eggnog.filtered.genes.gff 
```
Serpentine type 7TM GPCR chemoreceptor Srsx


Differntial expression in abdoment tissue 

Preparing data
```{r}
load("/Users/dshipilina/GitHub/VanessaExpression/deseq2_qc/deseq2.dds.RData")
head(colData(dds))
countLR<- dds@assays@data@listData[["counts"]]
colDataLR <- colData(dds)
names(colDataLR)[names(colDataLR)=="Group3"]<-"tissue"
names(colDataLR)[names(colDataLR)=="Group1"]<-"condition"
colDataLR=colDataLR[colDataLR$tissue == "A", ] 
```
Assembilng Deseq datast
```{r}
ddsLR <- DESeqDataSetFromMatrix(countData=countLR, colData =colDataLR, design = ~condition)
keep <- rowSums(counts(ddsLR)) >= 20
ddsLR <- ddsLR[keep,]
head(ddsLR)
```
Analysis
```{r}
ddsLR <- DESeq(ddsLR)
resLR <- results(ddsLR)
resLR <- resLR[order(resLR$padj),]
head(resLR)
```

 Plotting
```{r}
plotMA(resLR, ylim=c(-2,2))
vsdata <- vst(ddsLR, blind=FALSE)
plotPCA(vsdata, intgroup="condition")
```

